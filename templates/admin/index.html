{% extends "admin/base_site.html" %}
{% load admin_urls static %}

{% block title %}Dashboard | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2"></script>
<link rel="stylesheet" href="{% static 'css/admin/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="left-col">
        <div class="dashboard-stats">
            <div class="stat-card">
                <i class="fa-solid fa-book stat-icon"></i>
                <p class="stat-number" id="books-count">-</p>
                <p class="stat-label">Total Books</p>
            </div>

            <div class="stat-card">
                <i class="fa-solid fa-users stat-icon"></i>
                <p class="stat-number" id="users-count">-</p>
                <p class="stat-label">Active Users</p>
            </div>

            <div class="stat-card">
                <i class="fa-solid fa-clock stat-icon"></i>
                <p class="stat-number" id="pending-requests">-</p>
                <p class="stat-label">Pending Requests</p>
            </div>

            <div class="stat-card">
                <i class="fa-solid fa-exclamation-triangle stat-icon"></i>
                <p class="stat-number" id="overdue-loans">-</p>
                <p class="stat-label">Overdue Loans</p>
            </div>
        </div>

        <div class="statistics">
            <h3><i class="fa-solid fa-chart-simple"></i> Th·ªëng k√™ th∆∞ vi·ªán</h3>
            <div class="stats-controls">
                <label><strong>K·ª≥:</strong></label>
                <select id="stats-period">
                    <option value="month">Th√°ng n√†y</option>
                    <option value="year">NƒÉm nay</option>
                </select>
                <label><strong>NƒÉm:</strong></label>
                <input type="number" id="stats-year" min="2000" max="2999" style="width: 100px;">
                <label id="label-month"><strong>Th√°ng:</strong></label>
                <input type="number" id="stats-month" min="1" max="12" style="width: 70px;">
            </div>
            <div class="stats-grid">
                <div class="chart-card">
                    <h4>S·ªë l∆∞·ª£ng s√°ch theo th·ªÉ lo·∫°i (t·ªïng)</h4>
                    <canvas id="booksPerCategoryChart" height="160"></canvas>
                </div>
                <div class="chart-card">
                    <h4>Xu h∆∞·ªõng m∆∞·ª£n theo th·ªùi gian</h4>
                    <canvas id="loansOverTimeChart" height="160"></canvas>
                </div>
                <div class="chart-card">
                    <h4>Tr·∫°ng th√°i y√™u c·∫ßu m∆∞·ª£n s√°ch</h4>
                    <canvas id="loanStatusChart" height="160"></canvas>
                </div>
                <div class="chart-card">
                    <h4>Ng√¥n ng·ªØ s√°ch trong th∆∞ vi·ªán</h4>
                    <canvas id="languageChart" height="160"></canvas>
                </div>
            </div>
        </div>
    </div>

    <aside class="right-col">
        <div class="quick-actions">
            <h3>‚ö° Quick Actions</h3>
            <div class="action-grid">
                <a href="{% url 'admin:auth_user_changelist' %}" class="action-button">
                    üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng
                </a>
                <a href="{% url 'admin:catalog_category_changelist' %}" class="action-button">
                    üè∑Ô∏è Qu·∫£n l√Ω th·ªÉ lo·∫°i s√°ch
                </a>
                <a href="{% url 'admin:catalog_author_changelist' %}" class="action-button">
                    ‚úçÔ∏è Qu·∫£n l√Ω t√°c gi·∫£
                </a>
                <a href="{% url 'admin:catalog_publisher_changelist' %}" class="action-button">
                    üè¢ Qu·∫£n l√Ω nh√† xu·∫•t b·∫£n
                </a>
                <a href="{% url 'admin:catalog_book_changelist' %}" class="action-button">
                    üìö Qu·∫£n l√Ω s√°ch
                </a>
                <a href="{% url 'admin:catalog_borrowrequest_changelist' %}" class="action-button">
                    üìù Qu·∫£n l√Ω y√™u c·∫ßu m∆∞·ª£n s√°ch
                </a>
            </div>

            <h3 style="margin-top: 25px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                üìä Xu·∫•t d·ªØ li·ªáu Excel
            </h3>
            <div class="action-grid export-section">
                <a href="{% url 'admin-export-books' %}" class="action-button export-btn">
                    Xu·∫•t Excel S√°ch
                </a>
                <a href="{% url 'admin_export_categories_excel' %}" class="action-button export-btn">
                    Xu·∫•t Excel Th·ªÉ lo·∫°i
                </a>
                <a href="{% url 'admin_export_authors_excel' %}" class="action-button export-btn">
                    Xu·∫•t Excel T√°c gi·∫£
                </a>
                <a href="{% url 'admin_export_publishers_excel' %}" class="action-button export-btn">
                    Xu·∫•t Excel Nh√† XB
                </a>
            </div>
        </div>
        <div class="recent-activity">
            <h3>üïí Recent Activity</h3>
            <div id="recent-activity-list">
                <p>Loading recent activity...</p>
            </div>
        </div>
    </aside>
</div>

<script src="{% static 'js/admin/dashboard.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    AdminDashboard.init(
        '{% url "admin-stats-api" %}',
        '{% url "admin-activity-api" %}'
    );
});
</script>
{% endblock %}
